<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Video Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple spinner animation */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-4 max-w-2xl w-full">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8">
            <!-- Header -->
            <div class="text-center mb-8">
                <i class="fab fa-tiktok text-5xl mb-4 text-cyan-400"></i>
                <h1 class="text-3xl md:text-4xl font-bold">TikTok Video Downloader</h1>
                <p class="text-gray-400 mt-2">Paste a TikTok video link below to download it without a watermark.</p>
            </div>

            <!-- Input Form -->
            <form id="download-form" class="flex flex-col sm:flex-row gap-4">
                <input 
                    id="tiktok-url"
                    type="text" 
                    placeholder="Paste TikTok URL here..." 
                    class="flex-grow bg-gray-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 w-full"
                    required
                >
                <button 
                    type="submit" 
                    class="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 flex items-center justify-center"
                >
                    <i class="fas fa-download mr-2"></i>
                    <span>Download</span>
                </button>
            </form>

            <!-- Status/Result Area -->
            <div id="status" class="mt-8 text-center">
                <!-- Spinner will be shown here -->
            </div>
            <div id="result" class="mt-8 hidden">
                <!-- Results will be populated here -->
            </div>
        </div>
        
        <!-- Disclaimer Footer -->
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>This tool is for personal use only. Please respect the intellectual property rights of the content creators.</p>
        </footer>
    </div>

    <script>
        const downloadForm = document.getElementById('download-form');
        const urlInput = document.getElementById('tiktok-url');
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');

        // NEW: Redundant API endpoints for reliability
        const PRIMARY_API_ENDPOINT = 'https://co.wuk.sh/api/json';
        const FALLBACK_API_ENDPOINT = 'https://tikmate.app/abc?url=dl';

        downloadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const videoUrl = urlInput.value.trim();
            
            const tiktokUrlRegex = /^(https?:\/\/)?(www\.)?(tiktok\.com\/.*\/video\/\d+|vm\.tiktok\.com\/[a-zA-Z0-9]+)/;

            if (!videoUrl || !tiktokUrlRegex.test(videoUrl)) {
                showError('That doesn\'t look like a valid TikTok URL.');
                return;
            }

            clearResults();
            showSpinner();
            await fetchFromPrimaryAPI(videoUrl);
        });

        async function fetchFromPrimaryAPI(videoUrl) {
            try {
                const response = await fetch(PRIMARY_API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify({ url: videoUrl, isNoTTWatermark: true })
                });
                
                if (!response.ok) throw new Error('Primary API returned a network error.');
                
                const data = await response.json();

                if (data.status === 'error' || (!data.url && data.status !== 'picker')) {
                    throw new Error('Primary API could not process the link.');
                }
                
                hideSpinner();
                displayResultsFromPrimaryAPI(data);

            } catch (error) {
                console.warn('Primary API failed, trying fallback:', error);
                await fetchFromFallbackAPI(videoUrl); // If primary fails, automatically try the fallback.
            }
        }

        async function fetchFromFallbackAPI(videoUrl) {
            try {
                const response = await fetch(FALLBACK_API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },
                    body: `url=${encodeURIComponent(videoUrl)}`
                });

                if (!response.ok) throw new Error('Fallback API returned a network error.');

                const htmlContent = await response.text();
                hideSpinner();
                displayResultsFromFallbackAPI(htmlContent);

            } catch (error) {
                console.error('Fallback API also failed:', error);
                hideSpinner();
                showError('Both downloader services are currently unavailable. Please try again later.');
            }
        }
        
        function showSpinner() { statusDiv.innerHTML = '<div class="spinner mx-auto"></div>'; }
        function hideSpinner() { statusDiv.innerHTML = ''; }
        function showError(message) { statusDiv.innerHTML = `<p class="text-red-400 bg-red-900/50 p-3 rounded-lg">${message}</p>`; }
        function clearResults() {
            statusDiv.innerHTML = '';
            resultDiv.innerHTML = '';
            resultDiv.classList.add('hidden');
        }

        function displayResultsFromPrimaryAPI(data) {
            let downloadUrl = data.url;
            if (data.status === 'picker') {
                const videoOption = data.picker.find(item => item.type === 'video' && item.label && item.label.toLowerCase().includes('no watermark')) || data.picker.find(item => item.type === 'video');
                if (videoOption) downloadUrl = videoOption.url;
            }
            if (!downloadUrl) { showError('Could not find a valid download URL.'); return; }
            
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = createResultCard(data.text || 'Your video is ready!', data.thumb, downloadUrl);
        }
        
        function displayResultsFromFallbackAPI(htmlContent) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            const downloadButton = tempDiv.querySelector('.tik-mate-dl-area-buttons a');
            if (!downloadButton) { showError('Fallback service could not process this video.'); return; }

            const title = tempDiv.querySelector('.video-info p')?.textContent || 'Your video is ready!';
            const thumb = tempDiv.querySelector('.video-info img')?.src;
            const downloadUrl = downloadButton.href;

            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = createResultCard(title, thumb, downloadUrl);
        }
        
        function createResultCard(title, thumbUrl, downloadUrl) {
            return `
                <div class="bg-gray-700/50 rounded-lg p-6 flex flex-col items-center gap-4">
                     <p class="text-lg font-semibold text-center">${title}</p>
                    ${thumbUrl ? `<img src="${thumbUrl}" class="rounded-lg max-w-xs w-full" alt="Video Thumbnail">` : ''}
                    <a href="${downloadUrl}" target="_blank" rel="noopener noreferrer" class="block w-full max-w-xs bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 text-center no-underline">
                        <i class="fas fa-video mr-2"></i> Download Video
                    </a>
                </div>`;
        }
    </script>
</body>
</html>

