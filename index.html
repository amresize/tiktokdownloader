<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Video Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple spinner animation */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-4 max-w-2xl w-full">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8">
            <!-- Header -->
            <div class="text-center mb-8">
                <i class="fab fa-tiktok text-5xl mb-4 text-cyan-400"></i>
                <h1 class="text-3xl md:text-4xl font-bold">TikTok Video Downloader</h1>
                <p class="text-gray-400 mt-2">Paste a TikTok video link below to download it without a watermark.</p>
            </div>

            <!-- Input Form -->
            <form id="download-form" class="flex flex-col sm-flex-row gap-4">
                <input 
                    id="tiktok-url"
                    type="text" 
                    placeholder="Paste TikTok URL here..." 
                    class="flex-grow bg-gray-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 w-full"
                    required
                >
                <button 
                    type="submit" 
                    class="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 flex items-center justify-center"
                >
                    <i class="fas fa-download mr-2"></i>
                    <span>Download</span>
                </button>
            </form>

            <!-- Status/Result Area -->
            <div id="status" class="mt-8 text-center">
                <!-- Spinner will be shown here -->
            </div>
            <div id="result" class="mt-8 hidden">
                <!-- Results will be populated here -->
            </div>
        </div>
        
        <!-- Disclaimer Footer -->
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>This tool is for personal use only. Please respect the intellectual property rights of the content creators.</p>
        </footer>
    </div>

    <script>
        const downloadForm = document.getElementById('download-form');
        const urlInput = document.getElementById('tiktok-url');
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');

        // This API returns JSON, which is much more stable than parsing HTML.
        const API_ENDPOINT = 'https://co.wuk.sh/api/json';

        downloadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const videoUrl = urlInput.value.trim();
            
            const tiktokUrlRegex = /^(https?:\/\/)?(www\.)?(tiktok\.com\/.*\/video\/\d+|vm\.tiktok\.com\/[a-zA-Z0-9]+)/;

            if (!videoUrl) {
                showError('Please paste a TikTok URL.');
                return;
            }
            
            if (!tiktokUrlRegex.test(videoUrl)) {
                showError('That doesn\'t look like a valid TikTok URL. Please copy the full link from the share button.');
                return;
            }

            clearResults();
            showSpinner();

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        url: videoUrl,
                        isNoTTWatermark: true // Request no watermark version
                    })
                });
                
                // NEW: More detailed error checking based on the HTTP response status.
                if (!response.ok) {
                    let errorText = `Error: ${response.status} ${response.statusText}.`;
                    try {
                        const errorData = await response.json();
                        if (errorData && errorData.text) {
                            errorText = errorData.text; // Use the API's specific error message if available.
                        }
                    } catch (jsonError) {
                         // The error response wasn't valid JSON, stick with the status text.
                    }
                    throw new Error(errorText);
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) {
                console.error('Error fetching video:', error);
                showError(error.message || 'An unexpected error occurred.');
            } finally {
                hideSpinner();
            }
        });
        
        function showSpinner() {
            statusDiv.innerHTML = '<div class="spinner mx-auto"></div>';
        }

        function hideSpinner() {
            statusDiv.innerHTML = '';
        }

        function showError(message) {
            statusDiv.innerHTML = `<p class="text-red-400 bg-red-900/50 p-3 rounded-lg">${message}</p>`;
        }
        
        function clearResults() {
            statusDiv.innerHTML = '';
            resultDiv.innerHTML = '';
            resultDiv.classList.add('hidden');
        }

        // REWRITTEN displayResults to be more robust and handle more API response types.
        function displayResults(data) {
            if (data.status === 'error') {
                showError(data.text || 'Could not process this video link.');
                return;
            }
            
            let downloadUrl = data.url;

            // NEW: Handle cases where the API returns a 'picker' for multiple formats.
            if (data.status === 'picker') {
                // Find the first video URL without a watermark.
                const videoOption = data.picker.find(item => item.type === 'video' && item.label && item.label.toLowerCase().includes('no watermark'));
                if (videoOption && videoOption.url) {
                    downloadUrl = videoOption.url;
                } else if (data.picker.length > 0) {
                    // Fallback to the first available URL if no ideal one is found.
                    downloadUrl = data.picker[0].url;
                }
            } else if (data.status !== 'stream' && data.status !== 'success') {
                showError('The API returned an unexpected response. Please try again.');
                return;
            }

            if (!downloadUrl) {
                showError('Could not find a valid download URL in the API response.');
                return;
            }
            
            resultDiv.classList.remove('hidden');

            const linksContainer = document.createElement('div');
            linksContainer.className = 'w-full flex flex-col items-center gap-3 mt-4';
            
            const newLink = document.createElement('a');
            newLink.href = downloadUrl; // The direct download URL from the JSON response
            newLink.target = '_blank';
            newLink.rel = 'noopener noreferrer';
            newLink.className = 'block w-full max-w-xs bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 text-center no-underline';
            newLink.innerHTML = `<i class="fas fa-video mr-2"></i> Download Video`;
            linksContainer.appendChild(newLink);

            resultDiv.innerHTML = `
                <div class="bg-gray-700/50 rounded-lg p-6 flex flex-col items-center gap-4">
                     <p class="text-lg font-semibold text-center">${data.text || 'Your video is ready!'}</p>
                    <img src="${data.thumb}" class="rounded-lg max-w-xs w-full" alt="Video Thumbnail">
                    ${linksContainer.outerHTML}
                </div>`;
        }
    </script>
</body>
</html>

